<!DOCTYPE html>
<html lang="tr" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LisansTakip â€” Envanter Sistemi</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Bricolage+Grotesque:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
import { getAuth, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

const firebaseConfig = {
  apiKey: "AIzaSyBGDd-BPvTAbFculUUWCd8Gtgh03cYwzAg",
  authDomain: "license-tracker-fb51b.firebaseapp.com",
  projectId: "license-tracker-fb51b",
  storageBucket: "license-tracker-fb51b.firebasestorage.app",
  messagingSenderId: "284167863677",
  appId: "1:284167863677:web:016c4633561354317c2014"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
window._fb = { db, auth, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy, signInWithEmailAndPassword, signOut };
window.dispatchEvent(new Event('firebaseReady'));
</script>

<style>
/* â”€â”€ TOKENS â”€â”€ */
[data-theme="light"] {
  --bg:        #f4f2ee;
  --bg2:       #ebe8e2;
  --surface:   #ffffff;
  --surface2:  #f9f7f4;
  --border:    #e0dbd3;
  --text:      #1a1814;
  --text2:     #5a5650;
  --muted:     #9a9690;
  --accent:    #d4520a;
  --accent-bg: #fff0e8;
  --accent3:   #1a6fb5;
  --ok:        #1a7a42;
  --ok-bg:     #e8f7ee;
  --warn:      #b06b00;
  --warn-bg:   #fff6e0;
  --danger:    #c0292a;
  --danger-bg: #fdeaea;
  --shadow:    0 1px 3px rgba(0,0,0,0.08), 0 4px 16px rgba(0,0,0,0.06);
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.06);
}

[data-theme="dark"] {
  --bg:        #13120f;
  --bg2:       #1c1a16;
  --surface:   #211f1b;
  --surface2:  #2a2822;
  --border:    #3a3830;
  --text:      #f0ede8;
  --text2:     #a09c96;
  --muted:     #6a6760;
  --accent:    #f07030;
  --accent-bg: #2e1a0e;
  --accent3:   #5aabf0;
  --ok:        #3acc70;
  --ok-bg:     #0e2218;
  --warn:      #f0a030;
  --warn-bg:   #261a06;
  --danger:    #f05050;
  --danger-bg: #280e0e;
  --shadow:    0 1px 3px rgba(0,0,0,0.3), 0 4px 16px rgba(0,0,0,0.2);
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.2);
}

* { margin:0; padding:0; box-sizing:border-box; }

body {
  font-family: 'Bricolage Grotesque', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  transition: background 0.3s, color 0.3s;
}

/* â”€â”€ THEME TOGGLE â”€â”€ */
.theme-toggle {
  width: 44px; height: 24px;
  background: var(--border);
  border-radius: 12px;
  border: none;
  cursor: pointer;
  position: relative;
  transition: background 0.3s;
  flex-shrink: 0;
}
.theme-toggle::after {
  content: '';
  position: absolute;
  top: 3px; left: 3px;
  width: 18px; height: 18px;
  border-radius: 50%;
  background: var(--surface);
  transition: transform 0.3s, background 0.3s;
  box-shadow: var(--shadow-sm);
}
[data-theme="dark"] .theme-toggle { background: var(--accent); }
[data-theme="dark"] .theme-toggle::after { transform: translateX(20px); }
.theme-icon { font-size: 0.8rem; }

/* â”€â”€ LOGIN â”€â”€ */
#loginScreen {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  background: var(--bg);
}

.login-wrap {
  display: grid;
  grid-template-columns: 1fr 1fr;
  max-width: 900px;
  width: 100%;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: var(--shadow);
  border: 1px solid var(--border);
}

.login-left {
  background: var(--accent);
  padding: 3.5rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  position: relative;
  overflow: hidden;
}

.login-left::before {
  content: '';
  position: absolute;
  top: -60px; right: -60px;
  width: 200px; height: 200px;
  border-radius: 50%;
  background: rgba(255,255,255,0.12);
}
.login-left::after {
  content: '';
  position: absolute;
  bottom: -40px; left: -40px;
  width: 150px; height: 150px;
  border-radius: 50%;
  background: rgba(255,255,255,0.08);
}

.login-left-brand h1 {
  font-size: 2.4rem;
  font-weight: 800;
  color: #fff;
  line-height: 1.1;
  margin-bottom: 0.5rem;
}
.login-left-brand p {
  color: rgba(255,255,255,0.75);
  font-size: 0.9rem;
  line-height: 1.5;
}

.login-features {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  position: relative;
  z-index: 1;
}
.feature-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  color: rgba(255,255,255,0.9);
  font-size: 0.85rem;
}
.feature-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: rgba(255,255,255,0.6);
  flex-shrink: 0;
}

.login-right {
  background: var(--surface);
  padding: 3.5rem;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.login-right-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 2.5rem;
}

.login-title { font-size: 1.4rem; font-weight: 700; }
.login-sub { font-size: 0.8rem; color: var(--muted); margin-top: 0.2rem; font-family: 'DM Mono', monospace; }

.firebase-chip {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.35rem 0.75rem;
  background: var(--accent-bg);
  border: 1px solid var(--accent);
  border-radius: 99px;
  font-family: 'DM Mono', monospace;
  font-size: 0.62rem;
  color: var(--accent);
  margin-bottom: 2rem;
}

label {
  display: block;
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--text2);
  margin-bottom: 0.4rem;
  letter-spacing: 0.02em;
}

input, select {
  width: 100%;
  background: var(--bg2);
  border: 1.5px solid var(--border);
  color: var(--text);
  padding: 0.7rem 0.9rem;
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 0.9rem;
  border-radius: 8px;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
}
input:focus, select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-bg);
}
input::placeholder { color: var(--muted); }

.form-group { margin-bottom: 1rem; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }

.btn-login {
  width: 100%;
  padding: 0.85rem;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 8px;
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 0.95rem;
  font-weight: 700;
  cursor: pointer;
  margin-top: 0.5rem;
  transition: opacity 0.2s, transform 0.2s;
}
.btn-login:hover { opacity: 0.9; transform: translateY(-1px); }
.btn-login:disabled { opacity: 0.6; transform: none; cursor: not-allowed; }

.error-msg {
  color: var(--danger);
  font-family: 'DM Mono', monospace;
  font-size: 0.72rem;
  margin-top: 0.75rem;
  padding: 0.65rem 0.9rem;
  background: var(--danger-bg);
  border: 1px solid var(--danger);
  border-radius: 6px;
  display: none;
}

/* â”€â”€ APP â”€â”€ */
#appScreen { display: none; min-height: 100vh; }

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 2rem;
  height: 60px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow-sm);
}

.header-brand {
  font-size: 1.1rem;
  font-weight: 800;
  letter-spacing: -0.02em;
}
.header-brand span { color: var(--accent); }

.header-right { display: flex; align-items: center; gap: 0.75rem; }

.user-chip {
  font-family: 'DM Mono', monospace;
  font-size: 0.65rem;
  color: var(--muted);
  padding: 0.3rem 0.75rem;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 99px;
}

.btn-sm {
  padding: 0.35rem 0.9rem;
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 0.78rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.15s;
  border: 1.5px solid transparent;
}
.btn-outline-danger { background: transparent; border-color: var(--danger); color: var(--danger); }
.btn-outline-danger:hover { background: var(--danger); color: #fff; }
.btn-primary-sm { background: var(--accent); color: #fff; border-color: var(--accent); }
.btn-primary-sm:hover { opacity: 0.85; }
.btn-primary-sm:disabled { opacity: 0.6; cursor: not-allowed; }
.btn-ghost-sm { background: transparent; border-color: var(--border); color: var(--text2); }
.btn-ghost-sm:hover { border-color: var(--accent); color: var(--accent); }

/* â”€â”€ STATS â”€â”€ */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 1rem;
  padding: 1.25rem 2rem;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
}

.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1rem 1.25rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  box-shadow: var(--shadow-sm);
}

.stat-icon {
  width: 40px; height: 40px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  flex-shrink: 0;
}
.stat-icon.neutral { background: var(--bg2); }
.stat-icon.ok { background: var(--ok-bg); }
.stat-icon.warn { background: var(--warn-bg); }
.stat-icon.danger { background: var(--danger-bg); }

.stat-info {}
.stat-label { font-size: 0.7rem; color: var(--muted); font-weight: 500; }
.stat-value { font-size: 1.6rem; font-weight: 800; letter-spacing: -0.03em; line-height: 1.1; }
.stat-value.ok { color: var(--ok); }
.stat-value.warn { color: var(--warn); }
.stat-value.danger { color: var(--danger); }
.stat-value.neutral { color: var(--text); }

/* â”€â”€ ALERT â”€â”€ */
.alert-banner {
  margin: 1rem 2rem 0;
  padding: 0.9rem 1.25rem;
  border: 1px solid var(--warn);
  background: var(--warn-bg);
  border-radius: 10px;
  display: none;
  align-items: flex-start;
  gap: 0.75rem;
}
.alert-icon { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }
.alert-title { font-weight: 700; font-size: 0.82rem; color: var(--warn); margin-bottom: 0.25rem; }
.alert-list { font-family: 'DM Mono', monospace; font-size: 0.65rem; color: var(--text2); list-style: none; }
.alert-list li { padding: 0.1rem 0; }
.alert-list li::before { content: 'â€º '; color: var(--warn); }

/* â”€â”€ MAIN LAYOUT â”€â”€ */
.main { display: grid; grid-template-columns: 300px 1fr; min-height: calc(100vh - 60px - 94px); }

.sidebar {
  background: var(--surface);
  border-right: 1px solid var(--border);
  padding: 1.5rem;
  overflow-y: auto;
}

.sidebar-title {
  font-size: 0.7rem;
  font-weight: 700;
  color: var(--muted);
  letter-spacing: 0.1em;
  text-transform: uppercase;
  margin-bottom: 1.25rem;
  padding-bottom: 0.75rem;
  border-bottom: 1px solid var(--border);
}

/* â”€â”€ CONTENT â”€â”€ */
.content-area { padding: 1.5rem; background: var(--bg); }

.toolbar {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.25rem;
  flex-wrap: wrap;
}

.search-wrap { flex: 1; min-width: 200px; max-width: 320px; position: relative; }
.search-wrap input { padding-left: 2.25rem; font-size: 0.85rem; }
.search-icon { position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: 0.85rem; }

.filter-pills { display: flex; gap: 0.35rem; flex-wrap: wrap; }
.filter-pill {
  padding: 0.35rem 0.85rem;
  border-radius: 99px;
  font-size: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  border: 1.5px solid var(--border);
  background: transparent;
  color: var(--text2);
  transition: all 0.15s;
}
.filter-pill:hover { border-color: var(--accent); color: var(--accent); }
.filter-pill.active { background: var(--accent); border-color: var(--accent); color: #fff; }

.loading-row { display: flex; align-items: center; gap: 0.5rem; font-family: 'DM Mono', monospace; font-size: 0.7rem; color: var(--muted); margin-left: auto; }
.spinner { width: 14px; height: 14px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.6s linear infinite; flex-shrink: 0; }

/* â”€â”€ TABLE â”€â”€ */
.table-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}

table { width: 100%; border-collapse: collapse; }
thead th {
  padding: 0.7rem 1rem;
  text-align: left;
  font-size: 0.68rem;
  font-weight: 700;
  color: var(--muted);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  background: var(--surface2);
  border-bottom: 1px solid var(--border);
  white-space: nowrap;
}
tbody tr { border-bottom: 1px solid var(--border); transition: background 0.12s; }
tbody tr:last-child { border-bottom: none; }
tbody tr:hover { background: var(--surface2); }
tbody td { padding: 0.85rem 1rem; font-size: 0.85rem; vertical-align: middle; }

.badge {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  padding: 0.2rem 0.6rem;
  border-radius: 99px;
  font-size: 0.68rem;
  font-weight: 700;
  border: 1px solid transparent;
}
.badge-ok { color: var(--ok); background: var(--ok-bg); border-color: var(--ok); }
.badge-warn { color: var(--warn); background: var(--warn-bg); border-color: var(--warn); }
.badge-danger { color: var(--danger); background: var(--danger-bg); border-color: var(--danger); }
.badge-info { color: var(--accent3); background: var(--accent-bg); border-color: var(--accent3); }

.days-chip {
  display: inline-block;
  font-family: 'DM Mono', monospace;
  font-size: 0.75rem;
  font-weight: 500;
  padding: 0.15rem 0.5rem;
  border-radius: 4px;
}
.days-chip.ok { color: var(--ok); background: var(--ok-bg); }
.days-chip.warn { color: var(--warn); background: var(--warn-bg); }
.days-chip.danger { color: var(--danger); background: var(--danger-bg); }

.soft-text { color: var(--text2); font-size: 0.82rem; }
.mono-key { font-family: 'DM Mono', monospace; font-size: 0.65rem; color: var(--muted); margin-top: 2px; }

.act-btn {
  width: 28px; height: 28px;
  display: inline-flex; align-items: center; justify-content: center;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--muted);
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.78rem;
  transition: all 0.15s;
}
.act-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }
.act-btn.del:hover { border-color: var(--danger); color: var(--danger); background: var(--danger-bg); }
.actions { display: flex; gap: 0.4rem; }

.empty-state { text-align: center; padding: 4rem 2rem; color: var(--muted); }
.empty-icon { font-size: 2.5rem; margin-bottom: 0.75rem; }
.empty-title { font-size: 0.95rem; font-weight: 700; color: var(--text2); margin-bottom: 0.35rem; }
.empty-sub { font-family: 'DM Mono', monospace; font-size: 0.7rem; }

/* â”€â”€ MODAL â”€â”€ */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(4px);
  z-index: 500;
  display: none; align-items: center; justify-content: center;
  padding: 1rem;
}
.modal-overlay.open { display: flex; }
.modal {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  width: 100%; max-width: 500px;
  padding: 2rem;
  box-shadow: var(--shadow);
}
.modal-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 1.5rem; }
.modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
.modal-grid .full { grid-column: 1/-1; }
.modal-actions { display: flex; gap: 0.75rem; margin-top: 1.5rem; justify-content: flex-end; }

@keyframes spin { to { transform: rotate(360deg); } }
@keyframes slideUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
tbody tr { animation: slideUp 0.2s ease; }

@media (max-width: 900px) {
  .login-wrap { grid-template-columns: 1fr; }
  .login-left { display: none; }
  .main { grid-template-columns: 1fr; }
  .sidebar { border-right: none; border-bottom: 1px solid var(--border); }
  .stats-bar { grid-template-columns: 1fr 1fr; }
}
@media (max-width: 600px) {
  .stats-bar { grid-template-columns: 1fr 1fr; padding: 1rem; gap: 0.75rem; }
  .content-area, .sidebar { padding: 1rem; }
  .header { padding: 0 1rem; }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-wrap">
    <div class="login-left">
      <div class="login-left-brand">
        <h1>Lisans<br>Takip</h1>
        <p>YazÄ±lÄ±m lisanslarÄ±nÄ±zÄ± tek yerden yÃ¶netin, bitiÅŸ tarihlerini asla kaÃ§Ä±rmayÄ±n.</p>
      </div>
      <div class="login-features">
        <div class="feature-item"><div class="feature-dot"></div>Firebase Firestore ile gerÃ§ek zamanlÄ± senkronizasyon</div>
        <div class="feature-item"><div class="feature-dot"></div>BitiÅŸ tarihi yaklaÅŸÄ±nca otomatik uyarÄ±</div>
        <div class="feature-item"><div class="feature-dot"></div>Lisans anahtarÄ± ve maliyet takibi</div>
        <div class="feature-item"><div class="feature-dot"></div>Arama, filtreleme ve raporlama</div>
      </div>
    </div>
    <div class="login-right">
      <div class="login-right-header">
        <div>
          <div class="login-title">GiriÅŸ Yap</div>
          <div class="login-sub">license-tracker-fb51b</div>
        </div>
        <div style="display:flex;align-items:center;gap:0.5rem;">
          <span class="theme-icon" id="themeIcon">â˜€ï¸</span>
          <button class="theme-toggle" id="themeToggle" title="Tema deÄŸiÅŸtir"></button>
        </div>
      </div>
      <div class="firebase-chip">ğŸ”¥ Firebase baÄŸlantÄ±sÄ± yapÄ±landÄ±rÄ±ldÄ±</div>
      <div class="form-group">
        <label>E-Posta</label>
        <input type="email" id="loginEmail" placeholder="admin@sirket.com" autofocus>
      </div>
      <div class="form-group">
        <label>Åifre</label>
        <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      <button class="btn-login" id="loginBtn"><span id="loginBtnText">GiriÅŸ Yap â†’</span></button>
      <div class="error-msg" id="loginError"></div>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appScreen">
  <div class="header">
    <div class="header-brand">Lisans<span>Takip</span></div>
    <div class="header-right">
      <div class="user-chip" id="userChip">â€”</div>
      <span class="theme-icon" id="appThemeIcon">â˜€ï¸</span>
      <button class="theme-toggle" id="appThemeToggle" title="Tema deÄŸiÅŸtir"></button>
      <button class="btn-sm btn-outline-danger" id="logoutBtn">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
  </div>

  <div class="stats-bar">
    <div class="stat-card">
      <div class="stat-icon neutral">ğŸ“‹</div>
      <div class="stat-info"><div class="stat-label">Toplam</div><div class="stat-value neutral" id="statTotal">0</div></div>
    </div>
    <div class="stat-card">
      <div class="stat-icon ok">âœ“</div>
      <div class="stat-info"><div class="stat-label">Aktif</div><div class="stat-value ok" id="statActive">0</div></div>
    </div>
    <div class="stat-card">
      <div class="stat-icon warn">âš </div>
      <div class="stat-info"><div class="stat-label">YakÄ±nda Bitiyor</div><div class="stat-value warn" id="statExpiring">0</div></div>
    </div>
    <div class="stat-card">
      <div class="stat-icon danger">âœ•</div>
      <div class="stat-info"><div class="stat-label">SÃ¼resi DolmuÅŸ</div><div class="stat-value danger" id="statExpired">0</div></div>
    </div>
  </div>

  <div class="alert-banner" id="alertBanner">
    <div class="alert-icon">ğŸ””</div>
    <div class="alert-content">
      <div class="alert-title">Dikkat! SÃ¼resi yaklaÅŸan veya dolmuÅŸ lisanslar:</div>
      <ul class="alert-list" id="alertList"></ul>
    </div>
  </div>

  <div class="main">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="sidebar-title">ï¼‹ Yeni Lisans Ekle</div>
      <div class="form-group"><label>YazÄ±lÄ±m / ÃœrÃ¼n AdÄ± *</label><input type="text" id="f_name" placeholder="Microsoft Office 365"></div>
      <div class="form-group"><label>TedarikÃ§i</label><input type="text" id="f_vendor" placeholder="Microsoft"></div>
      <div class="form-group">
        <label>Kategori</label>
        <select id="f_category">
          <option value="">â€” SeÃ§in â€”</option>
          <option>Ä°ÅŸletim Sistemi</option><option>Ofis & Verimlilik</option><option>GÃ¼venlik</option>
          <option>GeliÅŸtirme AraÃ§larÄ±</option><option>TasarÄ±m</option><option>ERP / CRM</option>
          <option>Bulut & AltyapÄ±</option><option>DiÄŸer</option>
        </select>
      </div>
      <div class="form-row">
        <div><label>Lisans SayÄ±sÄ±</label><input type="number" id="f_count" placeholder="1" min="1"></div>
        <div><label>Maliyet (â‚º)</label><input type="number" id="f_cost" placeholder="0"></div>
      </div>
      <div class="form-row">
        <div><label>BaÅŸlangÄ±Ã§</label><input type="date" id="f_startDate"></div>
        <div><label>BitiÅŸ Tarihi *</label><input type="date" id="f_endDate"></div>
      </div>
      <div class="form-group"><label>Lisans AnahtarÄ±</label><input type="text" id="f_licenseKey" placeholder="XXXXX-XXXXX-XXXXX"></div>
      <div class="form-group"><label>Atanan KiÅŸi / Birim</label><input type="text" id="f_assignee" placeholder="IT DepartmanÄ±"></div>
      <div class="form-group"><label>Notlar</label><input type="text" id="f_notes" placeholder="Ek bilgi..."></div>
      <div class="form-group"><label>UyarÄ± EÅŸiÄŸi (gÃ¼n)</label><input type="number" id="f_warnDays" value="30" min="1"></div>
      <button class="btn-sm btn-primary-sm" id="addBtn" style="width:100%;padding:0.7rem;font-size:0.9rem;border-radius:8px;">
        <span id="addBtnText">LisansÄ± Kaydet</span>
      </button>
    </div>

    <!-- CONTENT -->
    <div class="content-area">
      <div class="toolbar">
        <div class="search-wrap">
          <span class="search-icon">ğŸ”</span>
          <input type="text" id="searchInput" placeholder="Ara...">
        </div>
        <div class="filter-pills">
          <button class="filter-pill active" data-filter="all">TÃ¼mÃ¼</button>
          <button class="filter-pill" data-filter="active">Aktif</button>
          <button class="filter-pill" data-filter="expiring">YakÄ±nda</button>
          <button class="filter-pill" data-filter="expired">DolmuÅŸ</button>
        </div>
        <div class="loading-row" id="tableLoading" style="display:none;"><div class="spinner"></div> YÃ¼kleniyor</div>
      </div>

      <div class="table-card">
        <table>
          <thead>
            <tr>
              <th>YazÄ±lÄ±m</th><th>TedarikÃ§i</th><th>Kategori</th><th>Adet</th>
              <th>BitiÅŸ</th><th>Kalan</th><th>Durum</th><th>Atanan</th><th></th>
            </tr>
          </thead>
          <tbody id="licenseTable">
            <tr><td colspan="9"><div class="empty-state"><div class="empty-icon">ğŸ“‹</div><div class="empty-title">HenÃ¼z lisans yok</div><div class="empty-sub">Sol panelden yeni lisans ekleyin</div></div></td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="editModal">
  <div class="modal">
    <div class="modal-title">âœï¸ LisansÄ± DÃ¼zenle</div>
    <div class="modal-grid">
      <div class="full"><label>YazÄ±lÄ±m / ÃœrÃ¼n AdÄ±</label><input type="text" id="edit_name"></div>
      <div class="full"><label>TedarikÃ§i</label><input type="text" id="edit_vendor"></div>
      <div><label>BitiÅŸ Tarihi</label><input type="date" id="edit_endDate"></div>
      <div><label>Lisans SayÄ±sÄ±</label><input type="number" id="edit_count"></div>
      <div><label>Maliyet (â‚º)</label><input type="number" id="edit_cost"></div>
      <div><label>UyarÄ± EÅŸiÄŸi (gÃ¼n)</label><input type="number" id="edit_warnDays"></div>
      <div class="full"><label>Atanan KiÅŸi / Birim</label><input type="text" id="edit_assignee"></div>
      <div class="full"><label>Notlar</label><input type="text" id="edit_notes"></div>
    </div>
    <div class="modal-actions">
      <button class="btn-sm btn-ghost-sm" id="closeModal">Ä°ptal</button>
      <button class="btn-sm btn-primary-sm" id="saveEditBtn">Kaydet</button>
    </div>
  </div>
</div>

<script>
let licenses = [], currentFilter = 'all', searchQuery = '', editingId = null, FB = null;

// â”€â”€ THEME â”€â”€
function applyTheme(t) {
  document.documentElement.setAttribute('data-theme', t);
  const icon = t === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
  ['themeIcon','appThemeIcon'].forEach(id => { const el = document.getElementById(id); if(el) el.textContent = icon; });
  localStorage.setItem('lt_theme', t);
}
function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme');
  applyTheme(current === 'dark' ? 'light' : 'dark');
}
applyTheme(localStorage.getItem('lt_theme') || 'light');
['themeToggle','appThemeToggle'].forEach(id => {
  const el = document.getElementById(id);
  if (el) el.addEventListener('click', toggleTheme);
});

// â”€â”€ FIREBASE â”€â”€
window.addEventListener('firebaseReady', () => {
  FB = window._fb;
  document.getElementById('loginBtn').addEventListener('click', doLogin);
  document.getElementById('loginPass').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
});

async function doLogin() {
  const email = document.getElementById('loginEmail').value.trim();
  const pass = document.getElementById('loginPass').value;
  const errEl = document.getElementById('loginError');
  const btn = document.getElementById('loginBtn');
  errEl.style.display = 'none';
  if (!email || !pass) { errEl.textContent = 'E-posta ve ÅŸifre gerekli.'; errEl.style.display = 'block'; return; }

  document.getElementById('loginBtnText').innerHTML = '<span style="display:flex;align-items:center;justify-content:center;gap:0.5rem;"><span class="spinner"></span> BaÄŸlanÄ±yor...</span>';
  btn.disabled = true;

  try {
    const cred = await FB.signInWithEmailAndPassword(FB.auth, email, pass);
    document.getElementById('userChip').textContent = cred.user.email;
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('appScreen').style.display = 'block';
    await loadLicenses();
  } catch (err) {
    const m = { 'auth/wrong-password':'Åifre yanlÄ±ÅŸ.','auth/invalid-credential':'E-posta veya ÅŸifre hatalÄ±.','auth/user-not-found':'KullanÄ±cÄ± bulunamadÄ±.','auth/invalid-email':'GeÃ§ersiz e-posta.','auth/too-many-requests':'Ã‡ok fazla deneme. LÃ¼tfen bekleyin.','auth/network-request-failed':'AÄŸ hatasÄ±.','auth/configuration-not-found':'Firebase Authentication aktif deÄŸil. Console â†’ Authentication â†’ Enable edin.' };
    errEl.textContent = m[err.code] || err.message;
    errEl.style.display = 'block';
  }
  document.getElementById('loginBtnText').textContent = 'GiriÅŸ Yap â†’';
  btn.disabled = false;
}

document.getElementById('logoutBtn').addEventListener('click', async () => {
  await FB.signOut(FB.auth);
  licenses = [];
  document.getElementById('appScreen').style.display = 'none';
  document.getElementById('loginScreen').style.display = 'flex';
  ['loginEmail','loginPass'].forEach(id => document.getElementById(id).value = '');
});

async function loadLicenses() {
  document.getElementById('tableLoading').style.display = 'flex';
  try {
    let snap;
    try { snap = await FB.getDocs(FB.query(FB.collection(FB.db,'licenses'), FB.orderBy('endDate','asc'))); }
    catch { snap = await FB.getDocs(FB.collection(FB.db,'licenses')); }
    licenses = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    licenses.sort((a,b) => new Date(a.endDate)-new Date(b.endDate));
    renderTable(); updateStats(); renderAlerts();
  } catch(e) { console.error(e); }
  document.getElementById('tableLoading').style.display = 'none';
}

document.getElementById('addBtn').addEventListener('click', async () => {
  const name = document.getElementById('f_name').value.trim();
  const endDate = document.getElementById('f_endDate').value;
  if (!name||!endDate) { alert('YazÄ±lÄ±m adÄ± ve bitiÅŸ tarihi zorunlu!'); return; }
  const data = { name, endDate, vendor: document.getElementById('f_vendor').value.trim(), category: document.getElementById('f_category').value, count: parseInt(document.getElementById('f_count').value)||1, cost: parseFloat(document.getElementById('f_cost').value)||0, startDate: document.getElementById('f_startDate').value, licenseKey: document.getElementById('f_licenseKey').value.trim(), assignee: document.getElementById('f_assignee').value.trim(), notes: document.getElementById('f_notes').value.trim(), warnDays: parseInt(document.getElementById('f_warnDays').value)||30, createdAt: new Date().toISOString() };
  const btn = document.getElementById('addBtn');
  document.getElementById('addBtnText').textContent='Kaydediliyor...'; btn.disabled=true;
  try {
    await FB.addDoc(FB.collection(FB.db,'licenses'), data);
    ['f_name','f_vendor','f_licenseKey','f_assignee','f_notes'].forEach(id=>document.getElementById(id).value='');
    document.getElementById('f_category').value=''; document.getElementById('f_count').value=''; document.getElementById('f_cost').value=''; document.getElementById('f_startDate').value=''; document.getElementById('f_endDate').value=''; document.getElementById('f_warnDays').value='30';
    await loadLicenses();
  } catch(e) { alert('KayÄ±t hatasÄ±: '+e.message); }
  document.getElementById('addBtnText').textContent='LisansÄ± Kaydet'; btn.disabled=false;
});

function getStatus(daysLeft, warnDays) { return daysLeft<0?'expired':daysLeft<=warnDays?'expiring':'active'; }
function formatDate(d) { return d?new Date(d).toLocaleDateString('tr-TR',{day:'2-digit',month:'2-digit',year:'numeric'}):'â€”'; }
function esc(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function renderTable() {
  const tbody = document.getElementById('licenseTable');
  const today = new Date(); today.setHours(0,0,0,0);
  const filtered = licenses.filter(l => {
    const d = Math.ceil((new Date(l.endDate)-today)/86400000);
    const st = getStatus(d,l.warnDays||30);
    if (currentFilter!=='all'&&st!==currentFilter) return false;
    if (searchQuery) { const q=searchQuery.toLowerCase(); return [l.name,l.vendor,l.category,l.assignee].some(x=>(x||'').toLowerCase().includes(q)); }
    return true;
  });
  if (!filtered.length) { tbody.innerHTML=`<tr><td colspan="9"><div class="empty-state"><div class="empty-icon">ğŸ”</div><div class="empty-title">SonuÃ§ bulunamadÄ±</div><div class="empty-sub">Filtre veya arama kriterini deÄŸiÅŸtirin</div></div></td></tr>`; return; }
  tbody.innerHTML = filtered.map(l => {
    const d = Math.ceil((new Date(l.endDate)-today)/86400000);
    const st = getStatus(d,l.warnDays||30);
    const dc = st==='expired'?'danger':st==='expiring'?'warn':'ok';
    const dt = st==='expired'?`${Math.abs(d)}g Ã¶nce doldu`:`${d}g kaldÄ±`;
    const badge = st==='expired'?'<span class="badge badge-danger">DolmuÅŸ</span>':st==='expiring'?'<span class="badge badge-warn">âš  YakÄ±nda</span>':'<span class="badge badge-ok">âœ“ Aktif</span>';
    return `<tr>
      <td><div style="font-weight:600">${esc(l.name)}</div>${l.licenseKey?`<div class="mono-key">${esc(l.licenseKey)}</div>`:''}</td>
      <td class="soft-text">${esc(l.vendor||'â€”')}</td>
      <td>${l.category?`<span class="badge badge-info">${esc(l.category)}</span>`:'<span class="soft-text">â€”</span>'}</td>
      <td style="font-family:'DM Mono',monospace;font-size:0.82rem">${l.count||1}</td>
      <td style="font-family:'DM Mono',monospace;font-size:0.8rem">${formatDate(l.endDate)}</td>
      <td><span class="days-chip ${dc}">${dt}</span></td>
      <td>${badge}</td>
      <td class="soft-text" style="font-size:0.8rem">${esc(l.assignee||'â€”')}</td>
      <td><div class="actions">
        <button class="act-btn" onclick="openEdit('${l.id}')" title="DÃ¼zenle">âœï¸</button>
        <button class="act-btn del" onclick="deleteLicense('${l.id}')" title="Sil">ğŸ—‘ï¸</button>
      </div></td>
    </tr>`;
  }).join('');
}

function updateStats() {
  const today = new Date(); today.setHours(0,0,0,0);
  let a=0,e=0,x=0;
  licenses.forEach(l => { const d=Math.ceil((new Date(l.endDate)-today)/86400000); const st=getStatus(d,l.warnDays||30); if(st==='active')a++;else if(st==='expiring')e++;else x++; });
  document.getElementById('statTotal').textContent=licenses.length;
  document.getElementById('statActive').textContent=a;
  document.getElementById('statExpiring').textContent=e;
  document.getElementById('statExpired').textContent=x;
}

function renderAlerts() {
  const today = new Date(); today.setHours(0,0,0,0);
  const banner=document.getElementById('alertBanner'), list=document.getElementById('alertList');
  const urgent=licenses.filter(l=>{const d=Math.ceil((new Date(l.endDate)-today)/86400000);return getStatus(d,l.warnDays||30)!=='active';}).sort((a,b)=>new Date(a.endDate)-new Date(b.endDate));
  if (urgent.length) { banner.style.display='flex'; list.innerHTML=urgent.map(l=>{const d=Math.ceil((new Date(l.endDate)-today)/86400000);return `<li><strong>${esc(l.name)}</strong> â€” ${d<0?Math.abs(d)+' gÃ¼n Ã¶nce doldu':d+' gÃ¼n kaldÄ± ('+formatDate(l.endDate)+')'}</li>`;}).join(''); }
  else banner.style.display='none';
}

async function deleteLicense(id) {
  if (!confirm('Bu lisansÄ± silmek istediÄŸinize emin misiniz?')) return;
  try { await FB.deleteDoc(FB.doc(FB.db,'licenses',id)); await loadLicenses(); } catch(e) { alert('Silme hatasÄ±: '+e.message); }
}
window.deleteLicense = deleteLicense;

function openEdit(id) {
  const l=licenses.find(x=>x.id===id); if(!l) return;
  editingId=id;
  document.getElementById('edit_name').value=l.name||'';
  document.getElementById('edit_vendor').value=l.vendor||'';
  document.getElementById('edit_endDate').value=l.endDate||'';
  document.getElementById('edit_count').value=l.count||1;
  document.getElementById('edit_cost').value=l.cost||0;
  document.getElementById('edit_warnDays').value=l.warnDays||30;
  document.getElementById('edit_assignee').value=l.assignee||'';
  document.getElementById('edit_notes').value=l.notes||'';
  document.getElementById('editModal').classList.add('open');
}
window.openEdit = openEdit;

document.getElementById('closeModal').addEventListener('click',()=>document.getElementById('editModal').classList.remove('open'));
document.getElementById('saveEditBtn').addEventListener('click', async ()=>{
  if (!editingId) return;
  const updates={name:document.getElementById('edit_name').value.trim(),vendor:document.getElementById('edit_vendor').value.trim(),endDate:document.getElementById('edit_endDate').value,count:parseInt(document.getElementById('edit_count').value)||1,cost:parseFloat(document.getElementById('edit_cost').value)||0,warnDays:parseInt(document.getElementById('edit_warnDays').value)||30,assignee:document.getElementById('edit_assignee').value.trim(),notes:document.getElementById('edit_notes').value.trim()};
  try { await FB.updateDoc(FB.doc(FB.db,'licenses',editingId),updates); document.getElementById('editModal').classList.remove('open'); await loadLicenses(); } catch(e) { alert('GÃ¼ncelleme hatasÄ±: '+e.message); }
});

document.getElementById('searchInput').addEventListener('input', e=>{searchQuery=e.target.value;renderTable();});
document.querySelectorAll('.filter-pill').forEach(btn=>btn.addEventListener('click',()=>{
  document.querySelectorAll('.filter-pill').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active'); currentFilter=btn.dataset.filter; renderTable();
}));
</script>
</body>
</html>
